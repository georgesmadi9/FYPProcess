<!-- Form to view all the projects available -->

<form role="form">

    <script cam-script type="text/form-script">
        // script to load variables and the make a few operations to read them correctly
        camForm.on('form-loaded', function() {
            $scope.contextPath = camForm.formUrl.split("/forms/")[0];
            $scope.taskId = camForm.taskId;
        });
        camForm.on('form-loaded', function() {
            // tell the form SDK to fetch the variable named 'customer'
            camForm.variableManager.fetchVariable('AVAILABLE_PROJECTS');
        });
      camForm.on('variables-fetched', function() {
        // work with the variable (bind it to the current AngularJS $scope)
        var projSTR = camForm.variableManager.variableValue('AVAILABLE_PROJECTS');
        // transform the strings array into JSON
        var i = 0;
        var l = projSTR.length;
        var projs = [];
        while (i < l) {
            var jsonobj = JSON.parse(projSTR[i]);
            projs.push(jsonobj);
            i++;
        }
        $scope.projects = [...projs];
      });


    </script>

    <div class="container-fluid">
        <table class="table table-striped">
            <thead>
            <tr>
                <td>Project Name</td>
                <td>Supervisor</td>
                <td>Number of members per team</td>
                <td></td>
            </tr>
            </thead>
            <tbody>
            <tr ng-repeat="proj in projects">
                <td>{{proj.projectname}}</td>
                <td>{{proj.advisor}}</td>
                <td>{{proj.studentsnumber}}</td>
                <td>
                    <a class="btn btn-primary"
                       href="{{contextPath}}/file-variable?taskId={{taskId}}&variableName=document"
                       target="_blank">Download PDF</a>
                </td>
            </tr>
            </tbody>
        </table>

    </div>

</form>
